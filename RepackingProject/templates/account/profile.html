{% extends 'base.html' %}

{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å ‚Äî {{ website_name }}{% endblock %}


{% block stylesheet %}
  <link rel="stylesheet" href="{% static 'assets/css/profile.css' %}">
{% endblock %}

{% block content %}
  <div class="profile-layout">
    <div class="profile-card">

      <h1>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <section>
        <h2>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <form id="profileForm" method="POST" action="{% url 'base-info-profile' %}">
          {% csrf_token %}

          {% for item in baseInfoProfileForm %}
            <div class="form-group">
              <label for="{{ item.id_for_label }}">{{ item.label }}</label>
              <input
                  type="{{ item.field.widget.input_type }}"
                  name="{{item.name}}"
                  id="{{ item.id_for_label }}"
                  placeholder="{{item.field.widget.attrs.placeholder}}"
                  value="{% if item.field.widget.input_type != 'password' %}{{item.value|default_if_none:''}}{% else %}{% endif %}"
                  {% if item.errors %}class="invalid-input"{% endif %}
              >
              <div class="invalid-feedback">
                {% if item.errors %}
                  {% for error in item.errors %}
                    {{error}}
                  {% endfor %}
                {% endif %}
              </div>
            </div>
          {% endfor %}

          {% if form.non_field_errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
          {% endif %}

          <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
      </section>

      <!-- –ü–∞—Ä–æ–ª—å -->
      <section>
        <h2>–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h2>
        <form id="passwordForm" method="POST" action="{% url 'change-password-profile' %}">
          {% csrf_token %}

          {% for item in changePasswordProfileForm %}
            <div class="form-group">
              <label for="{{ item.id_for_label }}">{{ item.label }}</label>
              <input
                  type="{{ item.field.widget.input_type }}"
                  name="{{item.name}}"
                  id="{{ item.id_for_label }}"
                  placeholder="{{item.field.widget.attrs.placeholder}}"
                  value="{% if item.field.widget.input_type != 'password' %}{{item.value|default_if_none:''}}{% else %}{% endif %}"
                  {% if item.errors %}class="invalid-input"{% endif %}
                  required
              >
              <div class="invalid-feedback">
                {% if item.errors %}
                  {% for error in item.errors %}
                    {{error}}
                  {% endfor %}
                {% endif %}
              </div>
            </div>
          {% endfor %}

          {% if form.non_field_errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
          {% endif %}


          <button type="submit" class="btn">üîê –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
        </form>
      </section>

      <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
      <section>
        <h2>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>

        <form id="securityForm" method="POST" action="{% url 'security-profile' %}">
          {% csrf_token %}
          {% for item in security2FAProfileForm %}
            <div class="switch-box">
              <span>{{ item.label }}</span>
              <label class="switch">
                <input
                  type="{{ item.field.widget.input_type }}"
                  name="{{item.name}}"
                  {% if item.value %}checked=""{% endif %}
                  id="{{ item.id_for_label }}"
                >
                <span class="slider"></span>
              </label>

              <div class="invalid-feedback d-none">
                {% if item.errors %}
                  {% for error in item.errors %}
                    {{error}}
                  {% endfor %}
                {% endif %}
              </div>
            </div>
          {% endfor %}

          {% if form.non_field_errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
          {% endif %}

          <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

        </form>

      </section>

      <a href="{% url 'logout' %}" class="link">üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</a>
    </div>
  </div>

  <script>
    const toggle2FA = document.getElementById('toggle2FA');
    const qrBlock = document.getElementById('qrBlock');
    const qrCode = document.getElementById('qrCode');
    const confirm2FA = document.getElementById('confirm2FA');
    let changeEmail = false;
  </script>

  <script src="{% static '/assets/js/profile.js' %}"></script>

{% endblock %}

